<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Skating Coriolis – 3 Modes (no flip)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div class="container">
    <h1>Skating Coriolis – 3 Modes</h1>
    <p class="muted">
      回転座標系の式に基づく単発シミュレーション（戻しはしません）。<br/>
      ① ideal: <code>r¨′ = 0</code>（遠心・コリオリを外力で打消す）／
      ② cor-only: <code>r¨′ = -2Ω×r˙′</code>（遠心のみ打消す）／
      ③ both: <code>r¨′ = -2Ω×r˙′ - Ω×(Ω×r′)</code>（どちらも打消さない）
    </p>

    <form id="params" class="grid">
      <fieldset>
        <legend>Pattern</legend>
        <label>Tempo (BPM)
          <input type="number" id="bpm" value="138" step="any" />
        </label>
        <label>Diameter (m)
          <input type="number" id="diameter" value="9" step="any" />
        </label>
        <label>Central angle (deg)
          <input type="number" id="centralDeg" value="180" step="any" />
        </label>
        <label>Total beats on arc
          <input type="number" id="totalBeats" value="6" step="any" />
        </label>
        <label>Rotation
          <select id="direction">
            <option value="ccw" selected>CCW (+ω)</option>
            <option value="cw">CW (−ω)</option>
          </select>
        </label>
        <label>Start beat (on arc)
          <input type="number" id="startBeat" value="0" step="any" />
        </label>
      </fieldset>

      <fieldset>
        <legend>Relative swing (rotating frame)</legend>
        <label>Swing beats (Δt in beats)
          <input type="number" id="swingBeats" value="1" step="any" min="0.1" />
        </label>
        <label>Planned travel A (m) <span class="hint">Δt で相対座標が移動する目安距離</span>
          <input type="number" id="swingAmp" value="1.0" step="any" />
        </label>
        <label>Initial offset l (m)
          <input type="number" id="l" value="0.0" step="any" />
        </label>
        <label>Initial offset angle θ (deg) <span class="hint">t̂=0°, r̂へ+（前→外）</span>
          <input type="number" id="theta0" value="0" step="any" />
        </label>
        <label>Initial velocity angle θ<sub>v</sub> (deg)
          <input type="number" id="thetaV" value="0" step="any" />
        </label>
        <label>Time step h (s)
          <input type="number" id="h" value="0.01" step="any" min="0.001" />
        </label>
      </fieldset>

      <div class="actions">
        <button type="button" id="btnDutch">Dutch preset</button>
        <button type="button" id="btnWillow">Willow preset</button>
        <button type="submit" id="btnSimulate">Simulate</button>
      </div>
    </form>

    <div class="canvas-row">
      <div class="canvas-panel">
        <h3>Absolute frame（世界座標）</h3>
        <canvas id="canvasAbs" width="800" height="520"></canvas>
        <div class="legend">
          <div><span class="chip chip-com"></span>CoM</div>
          <div><span class="chip chip-ideal"></span>ideal（遠心・コリオリ打消し）</div>
          <div><span class="chip chip-coronly"></span>cor-only（遠心のみ打消し）</div>
          <div><span class="chip chip-both"></span>both（打消しなし）</div>
        </div>
      </div>

      <div class="canvas-panel">
        <h3>Rotating frame（CoM中心, 横=t̂, 縦=r̂）</h3>
        <canvas id="canvasRot" width="800" height="520"></canvas>
        <div class="legend">
          <div><span class="chip chip-ideal"></span>ideal：r′(t)</div>
          <div><span class="chip chip-coronly"></span>cor-only：r′(t)</div>
          <div><span class="chip chip-both"></span>both：r′(t)</div>
        </div>
      </div>
    </div>

    <details class="notes">
      <summary>Notes / 数式</summary>
      <ul>
        <li>回転座標系：<code>a′ = r¨′ = -2Ω×r˙′ - Ω×(Ω×r′)</code>（定速回転）。</li>
        <li>ideal：外力が <code>a_cor</code>, <code>a_cf</code> を完全に打消し → <code>r¨′=0</code>。</li>
        <li>cor-only：外力が遠心だけ打消し → <code>r¨′=-2Ω×r˙′</code>。</li>
        <li>both：外力なし → <code>r¨′=-2Ω×r˙′ - Ω×(Ω×r′)</code>。</li>
        <li>絶対座標への変換：<code>p(t)=cm(t)+r_t′(t) t̂(φ)+r_n′(t) r̂(φ)</code>、<code>φ=φ₀+ωt</code>。</li>
      </ul>
    </details>
  </div>

  <script type="module" src="./script.js"></script>
</body>
</html>