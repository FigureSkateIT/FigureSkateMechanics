<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Skating Coriolis – 3 Modes (ideal,cor-only,both)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div class="container">
    <h1>Skating Coriolis – 3 Modes (ideal,cor-only,both)</h1>
    <p class="muted">
      回転座標系の式に基づく, 単発シミュレーション<br/>
      <div class="table-wrap">
        <table id="explainTable">
          <tbody>
            <tr>
              <td>①</td>
              <td>ideal: </td>
              <td><code>r¨′ = 0</code></td>
              <td>遠心力・コリオリ力を外力で打消す</td>
              <td>例：体の傾き＋フリーレッグの筋肉に力を入れる</td>
            </tr>
            <tr>
              <td>②</td>
              <td>cor-only: </td>
              <td><code>r¨′ = -2Ω×r˙′</code></td>
              <td>遠心力のみ外力（重力）で打消す</td>
              <td>例：体の傾きのみ</td>
            </tr>
            <tr>
              <td>③</td>
              <td>both: </td>
              <td><code>r¨′ = -2Ω×r˙′ - Ω×(Ω×r′)</code></td>
              <td>遠心力・コリオリ力どちらも打消さない</td>
              <td>例：体まっすぐ＋フリーレッグぶらぶら</td>
            </tr>
          </tbody>
        </table>
      </div>
    </p>

    <form id="params" class="grid">
      <fieldset>
        <legend>Pattern</legend>
        <label>Tempo (BPM)
          <input type="number" id="bpm" value="138" step="any" />
        </label>
        <label>Diameter (m)
          <input type="number" id="diameter" value="9" step="any" />
        </label>
        <label>Central angle (deg)
          <input type="number" id="centralDeg" value="180" step="any" />
        </label>
        <label>Total beats on arc
          <input type="number" id="totalBeats" value="6" step="any" />
        </label>
        <label>Rotation
          <select id="direction">
            <option value="ccw" selected>CCW (+ω)</option>
            <option value="cw">CW (−ω)</option>
          </select>
        </label>
        <label>Start beat (on arc)
          <input type="number" id="startBeat" value="0" step="any" />
        </label>
      </fieldset>

      <fieldset>
        <legend>Relative swing (rotating frame)</legend>
        <label>Swing beats (Δt in beats)
          <input type="number" id="swingBeats" value="1" step="any" min="0.1" />
        </label>
        <label>Planned travel A (m) <span class="hint">Δt で相対座標が移動する目安距離</span>
          <input type="number" id="swingAmp" value="1.0" step="any" />
        </label>
        <label>Initial offset l (m)
          <input type="number" id="l" value="0.0" step="any" />
        </label>
        <label>Initial offset angle θ (deg) <span class="hint">t̂=0°, r̂へ+（前→外）</span>
          <input type="number" id="theta0" value="0" step="any" />
        </label>
        <label>Initial velocity angle θ<sub>v</sub> (deg)
          <input type="number" id="thetaV" value="0" step="any" />
        </label>
        <label>Time step h (s)
          <input type="number" id="h" value="0.01" step="any" min="0.001" />
        </label>
      </fieldset>

      <div class="actions">
        <button type="button" id="btnDutchSwing">Dutch LFO Swing</button>
        <button type="button" id="btnDutchLFIStroke">Dtuch LFI Stroke</button>
        <button type="submit" id="btnSimulate">Simulate</button>
      </div>
    </form>

    <div class="canvas-row">
      <div class="canvas-panel">
        <h3>Absolute frame（世界座標）</h3>
        <canvas id="canvasAbs" width="800" height="520"></canvas>
        <div class="legend">
          <div><span class="chip chip-com"></span>CoM</div>
          <div><span class="chip chip-ideal"></span>ideal（遠心・コリオリ打消し）</div>
          <div><span class="chip chip-coronly"></span>cor-only（遠心のみ打消し）</div>
          <div><span class="chip chip-both"></span>both（打消しなし）</div>
        </div>
      </div>

      <div class="canvas-panel">
        <h3>Rotating frame（重心(CoM)中心）</h3>
        <canvas id="canvasRot" width="800" height="520"></canvas>
        <div class="legend">
          <div><span class="chip chip-ideal"></span>ideal：r′(t)</div>
          <div><span class="chip chip-coronly"></span>cor-only：r′(t)</div>
          <div><span class="chip chip-both"></span>both：r′(t)</div>
        </div>
      </div>
    </div>

    <section id="theory" class="theory-section">
      <h2>Theory (Analytical Values)</h2>
      <p class="muted">入力から計算した理論値（前方=0° 規約）</p>
      <div class="table-wrap">
        <table id="theoryTable">
          <thead>
            <tr>
              <th>Label</th>
              <th>Tb (s/beat)</th>
              <th>T (s)</th>
              <th>R (m)</th>
              <th>ω (rad/s)</th>
              <th>v_cm (m/s)</th>
              <th>Δt (s)</th>
              <th>v<sub>rel</sub> (m/s)</th>
              <th>a<sub>cf</sub> (m/s²)</th>
              <th>|a<sub>c</sub>| (m/s²)</th>
              <th>Δy (m)</th>
              <th>φ (deg)</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <details class="notes">
      <summary>Notes / 数式 / パラメータ</summary>
      <h4 style="margin:12px 0 6px">Theory（表の列）のパラメータ説明</h4>
      <ul>
        <li><code>Tb</code>：1拍の時間 [s]（<code>Tb = 60 / BPM</code>）</li>
        <li><code>T</code>：カーブ全体の時間 [s]（<code>T = totalBeats × Tb</code>）</li>
        <li><code>ω</code>：角速度 [rad/s]（符号付き：CCW=＋, CW=−。<code>|ω| = φ<span style="font-size:0.9em">span</span> / T</code>）</li>
        <li><code>R</code>：軌道半径 [m]（<code>R = diameter / 2</code>）</li>
        <li><code>v_cm</code>：重心速度の大きさ [m/s]（<code>v_cm = |ω| · R</code>）</li>
        <li><code>Δt</code>：スイング時間 [s]（<code>Δt = swingBeats × Tb</code>）</li>
        <li><code>v_rel</code>：相対速度の大きさ [m/s]（<code>v_rel = swingAmp / Δt</code>）</li>
        <li><code>a_cf</code>：遠心加速度 [m/s²]（<code>a_cf = ω² · R</code>）</li>
        <li><code>|a_c|</code>：コリオリ加速度の大きさ [m/s²]（<code>|a_c| = 2 |ω| · v_rel</code>）</li>
        <li><code>Δy</code>：横ずれ量 [m]（<code>Δy = ½ · |a_c| · Δt²</code>）</li>
        <li><code>φ</code>：偏角 [deg]（<code>φ = atan(Δy / swingAmp)</code> を度に換算）</li>
      </ul>

      <p class="muted">参考：重力加速度の大きさ <code>g ≈ 9.8 m/s²</code>（標準重力 <code>9.80665 m/s²</code>）。</p>

      <h4 style="margin:12px 0 6px">数式解説</h4>
      <ul>
        <li>回転座標系：<code>a′ = r¨′ = -2Ω×r˙′ - Ω×(Ω×r′)</code>（定速回転）。</li>
        <li>ideal：外力が <code>a_cor</code>, <code>a_cf</code> を完全に打消し → <code>r¨′=0</code>。</li>
        <li>cor-only：外力が遠心だけ打消し → <code>r¨′=-2Ω×r˙′</code>。</li>
        <li>both：外力なし → <code>r¨′=-2Ω×r˙′ - Ω×(Ω×r′)</code>。</li>
        <li>絶対座標への変換：<code>p(t)=cm(t)+r_t′(t) t̂(φ)+r_n′(t) r̂(φ)</code>、<code>φ=φ₀+ωt</code>。</li>
      </ul>
      <p class="muted"><a href="https://github.com/FigureSkateIT/FigureSkateMechanics">GitHub</a></p>
    </details>
  </div>

  <script type="module" src="./script.js"></script>
</body>
</html>